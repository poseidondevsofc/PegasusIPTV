<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin - Pegasus IPTV</title>
<style>body{font-family:Arial;background:#071027;color:#e6f3fb;padding:20px} .wrap{max-width:1000px;margin:0 auto} .card{background:#07182a;padding:14px;border-radius:8px;margin-bottom:12px} input,select{width:100%;padding:8px;border-radius:6px;border:1px solid #123;box-sizing:border-box;margin:6px 0} button{padding:8px 10px;border-radius:6px;background:#06b6d4;border:none;color:#042;cursor:pointer}</style>
</head>
<body>
<div class="wrap">
  <h1>Painel Admin - Pegasus IPTV</h1>
  <p>Faça login com a senha do administrador para acessar o painel.</p>

  <div class="card">
    <h3>Login Admin</h3>
    <input id="adminPass" type="password" placeholder="Senha admin">
    <button id="btnLogin">Entrar</button>
    <div id="loginMsg" style="color:#9fb6c9;margin-top:6px"></div>
  </div>

  <div id="panel" style="display:none">
    <div class="card">
      <h3>Criar usuário</h3>
      <input id="u_admin" placeholder="Senha admin (repita)" />
      <input id="u_username" placeholder="Usuário" />
      <input id="u_password" placeholder="Senha do usuário" />
      <input id="u_display" placeholder="Nome exibido (opcional)" />
      <input id="u_expire" placeholder="Data de expiração (YYYY-MM-DD)" />
      <button id="createUser">Criar usuário</button>
      <div id="userMsg" style="color:#9fb6c9;margin-top:6px"></div>
    </div>

    <div class="card">
      <h3>Gerenciar Categorias</h3>
      <input id="c_admin" placeholder="Senha admin (repita)" />
      <input id="c_name" placeholder="Nome da categoria" />
      <button id="addCat">Adicionar categoria</button>
      <div id="catMsg" style="color:#9fb6c9;margin-top:6px"></div>
      <h4>Categorias existentes</h4>
      <div id="catList">carregando...</div>
    </div>

    <div class="card">
      <h3>Adicionar Canal</h3>
      <input id="ch_admin" placeholder="Senha admin (repita)" />
      <input id="ch_name" placeholder="Nome do canal" />
      <input id="ch_stream" placeholder="URL do stream" />
      <input id="ch_logo" placeholder="URL do logo" />
      <select id="ch_cat"><option>carregando...</option></select>
      <button id="addCh">Adicionar canal</button>
      <div id="chanMsg" style="color:#9fb6c9;margin-top:6px"></div>
      <h4>Canais existentes</h4>
      <div id="chanList">carregando...</div>
    </div>

    <div class="card">
      <h3>Usuários existentes</h3>
      <div id="userList">carregando...</div>
    </div>
  </div>
</div>

<script>
const ADMIN_PW = 'trouxas';
document.getElementById('btnLogin').addEventListener('click', ()=>{
  const v = document.getElementById('adminPass').value;
  if (v===ADMIN_PW){ document.getElementById('panel').style.display='block'; document.getElementById('loginMsg').textContent='Acesso liberado'; loadAll(); }
  else document.getElementById('loginMsg').textContent='Senha incorreta';
});

async function loadAll(){
  const r = await fetch('/api/adminData'); const j = await r.json();
  const catList = document.getElementById('catList'); catList.innerHTML='';
  const sel = document.getElementById('ch_cat'); sel.innerHTML='';
  j.categories.forEach(c=>{ catList.innerHTML+=`<div style="margin:6px 0"><strong>${c.name}</strong> <button onclick="delCat(${c.id})">Excluir</button></div>`; sel.innerHTML+=`<option value="${c.id}">${c.name}</option>`; });
  const chanList = document.getElementById('chanList'); chanList.innerHTML='';
  j.channels.forEach(ch=>{ chanList.innerHTML+=`<div style="margin:6px 0"><strong>${ch.name}</strong> <br><small>${ch.stream_url}</small> <br><button onclick="delCh(${ch.id})">Excluir</button></div>`; });
  const userList = document.getElementById('userList'); userList.innerHTML='';
  j.users.forEach(u=>{ userList.innerHTML+=`<div style="margin:6px 0"><strong>${u.username}</strong> — ${u.display_name||''} — expira: ${u.expiration_date} <button onclick="delUser('${u.username}')">Excluir</button></div>`; });
}

document.getElementById('addCat').addEventListener('click', async ()=>{
  const admin = document.getElementById('c_admin').value; const name = document.getElementById('c_name').value.trim();
  const res = await fetch('/api/addCategory',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({admin_password:admin,name})}); const txt=await res.text(); document.getElementById('catMsg').textContent=txt; if(res.ok) loadAll();
});
document.getElementById('createUser').addEventListener('click', async ()=>{
  const admin = document.getElementById('u_admin').value; const username=document.getElementById('u_username').value.trim(); const password=document.getElementById('u_password').value; const display=document.getElementById('u_display').value; const exp=document.getElementById('u_expire').value;
  const res=await fetch('/api/addUser',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({admin_password:admin,username,password,displayName:display,expiresAt:exp})}); const txt=await res.text(); document.getElementById('userMsg').textContent=txt; if(res.ok) loadAll();
});
document.getElementById('addCh').addEventListener('click', async ()=>{
  const admin=document.getElementById('ch_admin').value; const name=document.getElementById('ch_name').value; const stream=document.getElementById('ch_stream').value; const logo=document.getElementById('ch_logo').value; const cat=document.getElementById('ch_cat').value;
  const res=await fetch('/api/addChannel',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({admin_password:admin,name,streamUrl:stream,logo,categoryId:cat})}); const txt=await res.text(); document.getElementById('chanMsg').textContent=txt; if(res.ok) loadAll();
});

async function delCat(id){ if(!confirm('Excluir categoria?')) return; const admin=document.getElementById('c_admin').value; const res=await fetch('/api/deleteCategory',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({admin_password:admin,id})}); const txt=await res.text(); alert(txt); loadAll(); }
async function delCh(id){ if(!confirm('Excluir canal?')) return; const admin=document.getElementById('ch_admin').value; const res=await fetch('/api/deleteChannel',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({admin_password:admin,id})}); const txt=await res.text(); alert(txt); loadAll(); }
async function delUser(u){ if(!confirm('Excluir usuário?')) return; const admin=document.getElementById('u_admin').value; const res=await fetch('/api/deleteUser',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({admin_password:admin,username:u})}); const txt=await res.text(); alert(txt); loadAll(); }
</script>
</body>
</html>
