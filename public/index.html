<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pegasus IPTV</title>
<style>body{font-family:Arial;background:#f6f8fb;padding:24px} .card{max-width:900px;margin:0 auto;background:#fff;padding:18px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)} input{padding:8px;border-radius:6px;border:1px solid #ddd;margin-right:8px} button{padding:8px 12px;border-radius:6px;background:#0b84ff;color:#fff;border:none}</style>
</head>
<body>
<div class="card">
  <h1>Pegasus IPTV</h1>
  <p>Faça login com seu usuário e senha. Após o login você verá a lista de canais (por categoria) e o link para usar no XCIPTV / Smarters.</p>

  <form id="form">
    <input id="user" placeholder="Usuário" required>
    <input id="pass" placeholder="Senha" type="password" required>
    <button>Entrar</button>
  </form>

  <div id="msg" style="color:#b00020;margin-top:8px"></div>
  <div id="content" style="margin-top:12px"></div>
</div>

<script>
const form = document.getElementById('form');
form.addEventListener('submit', async e=>{
  e.preventDefault();
  document.getElementById('msg').textContent='';
  document.getElementById('content').innerHTML='Carregando...';
  const u = document.getElementById('user').value.trim();
  const p = document.getElementById('pass').value.trim();
  try {
    const r2 = await fetch(`/api/playlist?user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`);
    if (!r2.ok) {
      const text = await r2.text();
      document.getElementById('content').innerHTML='';
      document.getElementById('msg').textContent = text;
      return;
    }
    const txt = await r2.text();
    const lines = txt.split('\n').filter(Boolean);
    let html = '<h3>Playlist (pré-visualização)</h3>';
    for (let i=0;i<lines.length;i++){
      if (lines[i].startsWith('#EXTINF')){
        const info = lines[i];
        const name = info.split(',').pop();
        const url = lines[i+1]||'';
        html += `<div style="padding:6px 0"><strong>${name}</strong><div style="font-size:13px;color:#666">${url}</div></div>`;
      }
    }
    html += `<div style="margin-top:10px;padding:8px;background:#eef6ff;border-radius:6px">Link para XCIPTV / Smarters: <code>${location.origin}/api/playlist</code> (use usuário e senha no app)</div>`;
    document.getElementById('content').innerHTML = html;
  } catch (err){
    document.getElementById('content').innerHTML='';
    document.getElementById('msg').textContent = 'Erro: '+err.message;
  }
});
</script>
</body>
</html>
